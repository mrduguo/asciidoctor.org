<!DOCTYPE html><!--[if IE 8]><html class="no-js lt-ie9" lang="en"><![endif]--><!--[if gt IE 8]><!--><html class="no-js" lang="en"><!--<![endif]--><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/asciidoctor.org/stylesheets/styles.css"><script src="/asciidoctor.org/javascripts/vendor/custom.modernizr.js"></script><title>Asciidoctor | An open source implementation of AsciiDoc in Ruby</title><link href="/feed.atom" rel="alternate" title="AsciiDoctor.org News Feed" type="application/atom+xml"><link rel="author" href="/humans.txt"></head><body class="antialiased"><nav class="top-bar"><ul class="title-area"><li class="name"><h1><a href="/">Asciidoctor</a></h1></li><li class="toggle-topbar menu-icon"><a href="#"><span></span></a></li></ul><section class="top-bar-section"><ul class="right"><li><a href="/asciidoctor.org/">About</a></li><li class="divider"></li><li><a href="/asciidoctor.org/news/">News</a></li><li class="divider"></li><li><a href="http://gist.asciidoctor.org">Gist</a></li><li class="divider"></li><li><a href="https://github.com/asciidoctor">Code</a></li><li class="divider"></li><li><a href="http://discuss.asciidoctor.org">Discuss</a></li><li class="divider"></li><li><a href="/asciidoctor.org/docs/">Docs</a></li><li class="divider"></li><li class="has-form"><a class="button" href="/asciidoctor.org/docs/asciidoc-writers-guide/">Get Writing!</a></li></ul></section></nav><div class="container"><div class="row"><div class="large-12 columns"><div id="content"><article class="post"><header class="entry-header"><h1 class="title"><a href="/news/2013/05/21/asciidoctor-js-render-asciidoc-in-the-browser/">asciidoctor.js - Render AsciiDoc in your browser!</a></h1><h4><em>by</em> <span class="author">Dan Allen</span> - <time class="pubdate" datetime="2013-05-21T01:29:55-06:00">Tuesday, May 21, 2013</time></h4></header><div class="entry-content"><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;ve combined <a href="http://asciidoctor.org">Asciidoctor</a> and <a href="http://opalrb.org">Opal</a> to bring AsciiDoc rendering to the browser!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="imageblock feature right">
<div class="content">
<img src="/images/opal-logo.png" alt="Opal" width="200" height="200">
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/asciidoctor/asciidoctor.js">asciidoctor.js</a> uses the <a href="http://opalrb.org">Opal</a> Ruby-to-JavaScript cross compiler to generate a direct JavaScript port of <a href="http://asciidoctor.org">Asciidoctor</a>, an implementation of AsciiDoc. The result is AsciiDoc rendering in the browser!</p>
</div>
<div class="paragraph">
<p>The project consists primarily of a Rake build script that executes the Opal compiler on the Asciidoctor source code to produce the asciidoctor.js script.</p>
</div>
<div class="paragraph">
<p>Opal parses the Ruby code and any required libraries, then rewrites the code into JavaScript under the Opal namespace.
The resulting JavaScript can be executed in any JavaScript runtime environment, such as a browser or node.js application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="proving-the-concept"><a class="anchor" href="#proving-the-concept"></a>Proving the concept</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When I first discovered Opal, I thought to myself, "yeah, this could work."
Little did I know that achieving this proof of concept was more than a small task.</p>
</div>
<div class="paragraph">
<p>The effort involved filling gaps in Opal to support all the features of the Ruby standard library that Asciidoctor uses, as well as changes in Asciidoctor to make it compatible with constraints imposed by JavaScript (such as immutable strings).</p>
</div>
<div class="paragraph">
<p>While there are still some shortcomings, I&#8217;m proud to say that asciidoctor.js can successfully render the complete AsciiDoc User Guide (a document that has served as a compliance benchmark throughout the development of Asciidoctor).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-scripts"><a class="anchor" href="#the-scripts"></a>The scripts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two scripts generated by the Rake build that are needed to run Asciidoctor in the browser:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">opal.js</dt>
<dd>
<p>The Ruby runtime in JavaScript</p>
</dd>
<dt class="hdlist1">asciidoctor.js</dt>
<dd>
<p>The JavaScript port of Asciidoctor</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Don&#8217;t fret over the large size of these files.
We haven&#8217;t even started to optimize, having only just achieved the proof of concept.</p>
</div>
<div class="paragraph">
<p>With that said, both files gzip rather nicely, bringing asciidoctor.js down from over 500K to around 90K.
There are options in Opal to generate more efficient code, but they are causing problems at the moment.
Once we sort out those issues, the size of the generated files should become quite acceptable.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You need to load both files into your JavaScript environment to use Asciidoctor.
For instance, in an HTML page, add these two <code>&lt;script&gt;</code> tags (ideally at the bottom of the page):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="html"><span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">opal.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">asciidoctor.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see these scripts in action by running the examples, described in the <a href="https://github.com/asciidoctor/asciidoctor.js#readme">README</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usage"><a class="anchor" href="#usage"></a>Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To interact with the generated code, you either:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Write code in Ruby that hooks into the native JavaScript environment, which Opal compiles into JavaScript</p>
</li>
<li>
<p>Invoke the JavaScript APIs that Opal generates directly from JavaScript</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here&#8217;s an example that shows how Ruby can interact with the native JavaScript environment to render a string of AsciiDoc in the browser:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="ruby">data = <span class="string"><span class="delimiter">%(</span><span class="content">= asciidoctor.js - Render AsciiDoc in your browser!
Dan Allen
2013-05-21

We've combined http://asciidoctor.org[Asciidoctor] and
http://opalrb.org[Opal] to bring AsciiDoc rendering to the browser!</span><span class="delimiter">)</span></span>

<span class="global-variable">$window</span>.addEventListener <span class="string"><span class="delimiter">'</span><span class="content">DOMContentLoaded</span><span class="delimiter">'</span></span>, proc {
  html_doc = <span class="constant">Asciidoctor</span>.render(data, <span class="symbol">:safe</span> =&gt; <span class="symbol">:safe</span>,
    <span class="symbol">:attributes</span> =&gt; <span class="string"><span class="delimiter">%w(</span><span class="content">notitle! anchors imagesdir=./images</span><span class="delimiter">)</span></span>)
  <span class="global-variable">$document</span>.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">content</span><span class="delimiter">'</span></span>).innerHTML = html_doc
}, <span class="predefined-constant">false</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="changes-to-asciidoctor"><a class="anchor" href="#changes-to-asciidoctor"></a>Changes to Asciidoctor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At the moment, some changes are necessary in Asciidoctor to get it to compile with Opal.
These changes are maintained in the asciidoctor.js branch of the Asciidoctor git repository, from which asciidoctor.js is compiled.
The goal is to eventually eliminate all of these differences so that Asciidoctor can be compiled to JavaScript as is.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="go-play"><a class="anchor" href="#go-play"></a>Go play!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now it&#8217;s time to go play with asciidoctor.js.
Explore what you can do with it and how it can be improved.
Then, get involved in either Asciidoctor or Opal to help make AsciiDoc in the browser the best it can be!</p>
</div>
</div>
</div></div><footer class="entry-footer"><div class="tags"><i class="label fa fa-tags"></i><a href="/news/tag/announcement/">announcement</a>, <a href="/news/tag/javascript/">javascript</a>, <a href="/news/tag/port/">port</a></div></footer><hr></article><div class="pagination-centered"><ul class="pagination"><li class="arrow unavailable"><a href="#"><i class="fa fa-fast-backward"></i></a></li><li class="arrow unavailable"><a href="#"><i class="fa fa-step-backward"></i></a></li><li>1 of 1</li><li class="arrow unavailable"><a href="#"><i class="fa fa-step-forward"></i></a></li><li class="arrow unavailable"><a href="#"><i class="fa fa-fast-forward"></i></a></li></ul></div></div></div></div></div><footer><div class="row full-width"><div class="large-6 columns"><div class="row" style="margin-bottom: 1em"><div class="large-5 columns"><p><i class="fa fa-fw fa-download"></i> Download: <a class="rubygem" href="https://rubygems.org/gems/asciidoctor"><img src="https://img.shields.io/gem/v/asciidoctor.svg" alt="Asciidoctor gem version" style="margin-top: -2px"></a><br><i class="fa fa-fw fa-github"></i> Development: <a href="https://github.com/asciidoctor">GitHub</a><br><i class="fa fa-fw fa-group"></i> Discussions: <a href="http://discuss.asciidoctor.org">Nabble</a></p></div><div class="large-7 columns"><p><i class="fa fa-fw fa-comments"></i> Chat: <a href="https://gitter.im/asciidoctor/asciidoctor">Gitter</a><br><i class="fa fa-fw fa-twitter"></i> Twitter: <a class="twitter" href="https://twitter.com/asciidoctor">@asciidoctor</a><br><i class="fa fa-fw fa-google-plus-sign"></i> Google+: <a href="https://plus.google.com/116431294697916948181" rel="publisher">Asciidoctor</a></p></div></div></div><div class="large-6 large-text-right columns"><p style="margin-bottom: 1em">Thanks to our <a href="/supporters/">supporters</a> and <a href="/contributors/">contributors</a>!</p><p>Composed in AsciiDoc. Styled by Foundation. Baked with Awestruct.<br>&copy; Asciidoctor Project 2019. Content licensed under CC BY 3.0.</p></div></div></footer><script>document.write('<script src=' + ('__proto__' in {} ? '/asciidoctor.org/javascripts/vendor/zepto' : '/asciidoctor.org/javascripts/vendor/jquery') + '.js><\/script>')</script><script>$('.toggle-navigation').click(function() { $('.navigation').toggle(); $('.content').toggleClass('large-8'); $('.content').toggleClass('large-12'); $('.toolbar').toggleClass('off'); });</script><script src="/asciidoctor.org/javascripts/foundation/foundation.js"></script><script src="/asciidoctor.org/javascripts/foundation/foundation.topbar.js"></script><script>$(document).foundation();</script><script>var langs = navigator.languages;if (langs) { $('article[lang]').each(function(i, article) {   var lang = article.getAttribute('lang');   if (!langs.find(function(candidate) { return candidate === lang || candidate.startsWith(lang + '-'); })) {     $(article).hide();   } });}</script><script>!function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);}(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create','UA-38215684-1','auto'),ga('send','pageview');</script></body></html>